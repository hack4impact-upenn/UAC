<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<link rel="icon" href="../../favicon.ico">

<title>Home</title>

<!-- Bootstrap core CSS -->
<link href="../dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Bootstrap theme -->
<link href="../dist/css/bootstrap-theme.min.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="theme.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
<script src="../../assets/js/ie-emulation-modes-warning.js"></script>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="jquery-1.11.2.min.js"></script>


</head>

<style>

    body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        margin: 100px;
    }


    text {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

/* Adjust padding to create space between grid lines */
    .row {
        padding:10px;
    }
    
    .form-control {
        width: 100px;
    }

    /* Adjust colors of bars in legend/key */
    .red { color:"#DC4E00"; }
    .blue { color:"#89CEDE"; }

    .labels {
        margin-bottom:80px;
    }

</style>

<body role="document">

<!-- NAVBAR built by bootstrap -->
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">UAC Expense Optimizer</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li ><a href="#search">SEARCH</a></li>
                <li class="active"><a href="#savings">SAVINGS</a></li>
                <li><a href="#rankings">RANKINGS</a></li>
                <li><a href="#contact">CONTACT</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class="container theme-showcase" role="main">

    <div class="row"> 
        <div class="col-md-8">Savings Breakdown</div>
        <div class="col-md-4">
            <form>
                <label><input type="radio" name="mode" value="grouped" checked> Grouped</label>
                <label><input type="radio" name="mode" value="stacked"> Stacked</label>
            </form>
        </div>
    </div>
    <div class="row"> 
        <div class="col-md-3"><span class="glyphicon glyphicon-stop" style="color:#DC4E00" aria-hidden="true">  Current Costs</span></div>
    </div>
    <div class="row"> 
        <div class="col-md-3"><span class="glyphicon glyphicon-stop" style="color:#89CEDE" aria-hidden="true">  Costs with UAC</span></div>
    </div>
    <div class="row"> 
        <div class="col-md-8">
            <div id="svg_container"> 
            </div>
        </div>  
        <div class="col-md-4"> 
            
            <form id="costs_form">
                <div class="form-group" >
                    <label for="legal">Legal</label>
                    <input type="text" class="form-control" id="legal" placeholder="">
                </div>
                <div class="form-group">
                    <label for="accounting">Accounting</label>
                    <input type="text" class="form-control" id="accounting" placeholder="">
                </div>
                <div class="form-group">
                    <label for="insurance">Insurance</label>
                    <input type="text" class="form-control" id="insurance" placeholder="">
                </div>
                <div class="form-group">
                    <label for="compensation">Compensation</label>
                    <input type="text" class="form-control" id="compensation" placeholder="">
                </div>
                <div class="form-group">
                    <label for="services">Services</label>
                    <input type="text" class="form-control" id="services" placeholder="">
                </div>
                <div class="form-group">
                    <label for "other">Other</label>
                    <input type="text" class="form-control" id="other" placeholder="">
                </div>
                <button type="submit" class="btn btn-default" id="submit_button">Submit</button>
            </form>
        </div>
    </div>

    <div class="row"> 
        <div class="col-md-8">How Do You Stack Up?</div>
        <div class="col-md-4">
            
        </div>
    </div>

    <div class="row"> 
        <div class='col-md-1'>
            <p class="labels">Total</p>
            <p class="labels">Legal</p>
            <p class="labels">Accounting</p>
            <p class="labels">Insurance</p>
            <p class="labels">Compensation</p>
            <p class="labels">Services</p>
            <p class="labels">Other</p>
        </div>
        <div class="col-md-8">
            <div id="svg2_container"> 
                

            </div>
        </div>
        <div class="col-md-3">
            other column
        </div>
    </div>

    <linearGradient id="grad">
       <stop offset="0" stop-color="#12f84f"/>
       <stop offset="1" stop-color="#f00f0f"/>
    </linearGradient>

</div> <!-- /container -->

<script>

/***************************************
BUILDING BAR GRAPH
****************************************/

/* IMPORTANT: THE DATA */
/* 
    To change the data set, change variable expense_data (below).
    expense_data[0] refers to the current costs being spent in 0-7 categories.
    expense_data[1] refers to the possible costs if user makes switch to UAC, in same 0-7 categories. 
    Both graphs pull from 'expense data' currently for demo, but second graph should pull from data comparing user to other non-profits.
*/

    var expense_data = [[210,40,30,20,50,60,10],[120,10,15,10,25,50,10]];

    populateForm(); // to fill in cost form with current data 

    var n = 2, // number of layers
        m = 7; // number of samples per layer
    var x;
    var y;
    var rect;
    var yGroupMax;
    var yStackMax;
    var width;
    var height;

    createBarGraph();

    function createBarGraph() {
        
        var stack = d3.layout.stack();
        var layers = stack(d3.range(n).map(function(x) {return getData(x); }));
        console.log("LAYERS");
        console.log(layers);
        
        yGroupMax = d3.max(layers, function(layer) { return d3.max(layer, 
            function(d) { return d.y; }); });
        
        yStackMax = d3.max(layers, function(layer) { return d3.max(layer, 
            function(d) { return d.y0 + d.y; }); });

        var margin = {top: 40, right: 10, bottom: 20, left: 10};
        width = 800 - margin.left - margin.right;
        var diagramWidth = 800 - margin.left - margin.right - 200;
        height = 500 - margin.top - margin.bottom;

        x = d3.scale.ordinal()
        .domain(d3.range(m))
        .rangeRoundBands([0, diagramWidth], .08);

        y = d3.scale.linear()
        .domain([0, yStackMax])
        .range([height, 0]);

        // set bar graph colors
        var color = d3.scale.linear().domain([0, n - 1]).range(["#DC4E00", "#89CEDE"]);

        var xAxis = d3.svg.axis()
        .scale(x)
        .tickSize(1)
        .tickPadding(6)
        .ticks([0,1,2,3,4,5,6])
        .tickValues([0,1,2,3,4,5,6])
        .tickFormat(function(d) { return convertToLabel(d); })
        .orient("bottom");

        var yAxis = d3.svg.axis()
        .scale(y)
        .tickSize(1)
        .ticks(20)
        .tickPadding(0)
        .tickFormat(function(d) {return '$' + d; })
        .orient("left");

        var offset = margin.left + 30; // to move diagram right
        var svg = d3.select("#svg_container").append("svg")
        .attr("width", width + margin.left)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + offset + "," + margin.top + ")");

        var layer = svg.selectAll(".layer")
        .data(layers)
        .enter().append("g")
        .attr("class", "layer")
        .style("fill", function(d, i) { return color(i); });

        rect = layer.selectAll("rect")
        .data(function(d) { return d; })
        .enter().append("rect")
        .attr("x", function(d) { return x(d.x); })
        .attr("y", height)
        .attr("width", x.rangeBand())
        .attr("height", 0);

        rect.transition()
        .delay(function(d, i) { return i * 10; })
        .attr("y", function(d) { return y(d.y0 + d.y); })
        .attr("height", function(d) { return y(d.y0) - y(d.y0 + d.y); });

        svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

        svg.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate(0,0)")
        .call(yAxis);

        d3.selectAll("input").on("change", change);

        console.log("change()");
        change();
    }

    function convertToLabel(d) {
        switch(d) {
            case 0:
                return 'Total';
                break;
            case 1:
                return 'Legal';
                break;
            case 2:
                return 'Accounting';
                break;
            case 3:
                return 'Insurance';
                break;
            case 4:
                return 'Compensation';
                break;
            case 5:
                return 'Services';
                break; 
            case 6:
                return 'Other';
                break;
        } 
    }

    // to change graph from STACKED to GROUPED bars
    function change() {
        if (this.value === "stacked") transitionStacked();
        else transitionGrouped();
    }

    function transitionGrouped() {
        console.log('transitionGrouped()');
        y.domain([0, yGroupMax]);

        rect.transition()
        .duration(500)
        .delay(function(d, i) { return i * 10; })
        .attr("x", function(d, i, j) { return x(d.x) + x.rangeBand() / n * j; })
        .attr("width", x.rangeBand() / n)
        .transition()
        .attr("y", function(d) { return y(d.y); })
        .attr("height", function(d) { return height - y(d.y); });
        console.log('transitionGrouped() end');
    }

    function transitionStacked() {
        console.log('transitionStacked()')
        y.domain([0, yStackMax]);

        rect.transition()
        .duration(500)
        .delay(function(d, i) { return i * 10; })
        .attr("y", function(d) { return y(d.y0 + d.y); })
        .attr("height", function(d) { return y(d.y0) - y(d.y0 + d.y); })
        .transition()
        .attr("x", function(d) { return x(d.x); })
        .attr("width", x.rangeBand());
    }
    
    /* BAR GRAPH DATA GETTER */
    // n = x axis num categories
    // o = 0.1
    function getData(n) {
        console.log(n);
        var a = expense_data[n];
        console.log(a);
        // if (n==0) {
        //     a = [70,40,30,20,50,60,10];
        // } else {
        //     a = [60,10,15,10,25,50,10];
        // }
        var m = a.map(function(d, i) {return {x: i, y: d}; });
        console.log(m);
        return m;
    }

    function populateForm() {
        $('#legal').val(expense_data[0][1]);
        $('#accounting').val(expense_data[0][2]);
        $('#insurance').val(expense_data[0][3]);
        $('#compensation').val(expense_data[0][4]);
        $('#services').val(expense_data[0][5]);
        $('#other').val(expense_data[0][6]);
        // $('#legal').attr('text', expense_data[0][1]);
        // $('#accounting').attr('text', expense_data[0][2]);
        // $('#insurance').attr('text', expense_data[0][3]);
        // $('#compensation').attr('text', expense_data[0][4]);
        // $('#services').attr('text', expense_data[0][5]);
        // $('#other').attr('text', expense_data[0][6]);
    }

    $('#costs_form').submit(function() {
        var $inputs = $('#costs_form :input');
        
        var values = [];
        var total = 0;
        $inputs.each(function() {
            var value = parseInt($(this).val());
            if (!isNaN(value)) {
                console.log('VALUE');
                console.log(value);
                total = total + value;
                values.push(value);
            }
        });

        values.unshift(total);
        console.log(values);

        expense_data[0] = values;

        $('#svg_container').empty();
        createBarGraph();
        return false;
    });

/***************************************
BUILDING HORIZONTAL SLIDER BARS
****************************************/

    var numBars = 7;
    var width = 800;
    var height = numBars*100;

    createHorizontalBars();

    function createHorizontalBars() {
        var rect_container = d3.select("#svg2_container").append("svg")
        .attr("width", width)
        .attr("height",height);

        var rectWidth = width - 100;
        var rectHeight = height/20;

        var gradient = rect_container.append("linearGradient")
            .attr('y1', 0)
            .attr('y2', 0)
            .attr('x1', 0)
            .attr('x2', width-100)
            .attr('x3', width-100)
            .attr('id', "gradient")
            .attr('gradientUnits', 'userSpaceOnUse')

        gradient
        .append("stop")
        .attr("offset", "0")
        .attr("stop-color", "#DC4E00")

        gradient
        .append("stop")
        .attr("offset", "0.5")
        .attr("stop-color", "#ffdb33")
        
        gradient
        .append("stop")
        .attr("offset", "1")
        .attr("stop-color", "#31c960")

        for (var i = 0; i < numBars; i++) {
            rect_container.append("rect")
            .attr("x",0)
            .attr("y",i*100)
            .attr("width",rectWidth)
            .attr("height",rectHeight)
            .attr("fill", "url(#gradient)");
        }

        for (var i = 0; i < numBars; i++) {
            rect_container.append("line")
            .attr('x1', rectWidth - (expense_data[0][i] * rectWidth / 100))
            .attr('y1', i*100)
            .attr('x2', rectWidth - (expense_data[0][i] * rectWidth / 100))
            .attr('y2', i*100 + rectHeight)
            .attr('stroke-width',2)
            .attr('stroke','black');

            rect_container.append("line")
            .attr('x1', rectWidth - (expense_data[1][i] * rectWidth / 100))
            .attr('y1', i*100)
            .attr('x2', rectWidth - (expense_data[1][i] * rectWidth / 100))
            .attr('y2', i*100 + rectHeight)
            .attr('stroke-width',2)
            .attr('stroke','white');
        }
    }
    

</script>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="../../dist/js/bootstrap.min.js"></script>
<script src="../../assets/js/docs.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
</body>
</html>
